          <i class="ph ph-x text-xl"></i>
        </button>
      </div>
      <div class="mt-4 grid sm:grid-cols-2 gap-4 text-sm">
        <label class="flex items-center gap-3">
          <input type="checkbox" id="adaContrast" class="h-4 w-4"> Alto contraste
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" id="adaPause" class="h-4 w-4"> Pausar animaciones
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" id="adaLinks" class="h-4 w-4"> Resaltar enlaces
        </label>
        <label class="flex items-center gap-3">
          <input type="checkbox" id="adaSpacing" class="h-4 w-4"> Más espaciado de texto
        </label>
        <div class="sm:col-span-2">
          <label for="adaZoom" class="block mb-1">Zoom de fuente</label>
          <input id="adaZoom" type="range" min="90" max="130" step="5" value="100" class="w-full">
        </div>
        <div class="sm:col-span-2">
          <label for="adaColor" class="block mb-1">Filtro daltonismo</label>
          <select id="adaColor" class="w-full rounded-xl border px-3 py-2">
            <option value="">Ninguno</option>
            <option value="protanopia">Protanopia</option>
            <option value="deuteranopia">Deuteranopia</option>
            <option value="tritanopia">Tritanopia</option>
          </select>
        </div>
      </div>
      <div class="mt-6 flex items-center justify-end gap-3">
        <button id="adaReset" class="px-4 py-2 rounded-xl border">Restablecer</button>
        <button id="adaSave" class="px-4 py-2 rounded-xl bg-indigo-600 text-white">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    /* ==========================
       Stripe (placeholder)
       Reemplaza STRIPE_PUBLISHABLE_KEY y URL de Checkout
    =========================== */
    document.getElementById('stripeBtn').addEventListener('click', () => {
      alert('Stripe Checkout placeholder. Conecta tu Checkout y redirige aquí.');
      // window.location.href = 'https://checkout.stripe.com/c/pay_xxx';
    });

    /* ==========================
       Calendly inline render
    =========================== */
    window.addEventListener('load', function () {
      if (window.Calendly) {
        Calendly.initInlineWidget({
          url: document.getElementById('calendly-inline-widget').dataset.url,
          parentElement: document.getElementById('calendly-inline-widget')
        });
      }
    });

    /* ==========================
       Testimonios - Carrusel accesible
    =========================== */
    const tTrack = document.getElementById('tTrack');
    const dots = Array.from(document.querySelectorAll('.carousel-dot'));
    let idx = 0, total = dots.length, timer = null;

    function goTo(i, announce=false) {
      idx = (i + total) % total;
      tTrack.style.transform = 'translateX(' + (-100 * idx) + '%)';
      dots.forEach((d, j) => d.setAttribute('aria-current', j === idx ? 'true' : 'false'));
      if (announce) tTrack.setAttribute('aria-label', 'Mostrando testimonio ' + (idx+1) + ' de ' + total);
    }
    function startAuto() { timer = setInterval(() => goTo(idx+1), 6000); }
    function stopAuto() { if (timer) clearInterval(timer); }

    dots.forEach((d, j) => {
      d.addEventListener('click', () => { stopAuto(); goTo(j, true); startAuto(); });
      d.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); stopAuto(); goTo(j, true); startAuto(); }
      });
    });
    goTo(0); startAuto();

    /* ==========================
       Test adaptativo (20 ítems)
       - Estructura lista para extender fácil
       - 3 ejemplos por tipo incluidos
    =========================== */
    const bank = {
      comprension: [
        { q: 'She ___ to the store yesterday.', a: ['go', 'goes', 'went', 'gone'], correct: 2, level: 1 },
        { q: 'Choose the best title for a text sobre “climate change”.', a: ['Cooking basics','Rising temperatures','Medieval kings','Car parts'], correct: 1, level: 2 },
        { q: 'Según el audio (opcional): ¿Cuál es la intención del hablante?', a: ['Saludar','Pedir ayuda','Vender un producto','Quejarse'], correct: 2, level: 3, audio:true, transcript:'Hi there, could you help me with…' }
      ],
      gramatica: [
        { q: 'If I ___ more time, I would learn Japanese.', a: ['have','had','would have','has'], correct: 1, level: 2 },
        { q: 'They ___ finished their homework.', a: ['has','have','are','did'], correct: 1, level: 1 },
        { q: 'I wish I ___ taller.', a: ['am','were','was','be'], correct: 1, level: 3 }
      ],
      vocab: [
        { q: 'Synonym of “improve”.', a: ['worsen','enhance','ignore','decline'], correct: 1, level: 2 },
        { q: '“Affordable” significa:', a: ['Costoso','Accesible','Rápido','Frágil'], correct: 1, level: 1 },
        { q: '“Insight” se refiere a:', a: ['Una broma','Una iluminación/entendimiento','Una prisa','Un objeto'], correct: 1, level: 3 }
      ]
    };

    const quizRoot = document.getElementById('quizRoot');
    const startBtn = document.getElementById('startQuiz');

    function pickNext(prevCorrect, currentLevel) {
      // Regla simple: +1 nivel si correcto, -1 si incorrecto (entre 1..3)
      let nextLevel = currentLevel + (prevCorrect ? 1 : -1);
      nextLevel = Math.min(3, Math.max(1, nextLevel));
      return nextLevel;
    }

    function buildQuiz() {
      quizRoot.innerHTML = '';
      const state = { count: 0, max: 20, level: 2, score: 0 };
      const types = ['comprension', 'gramatica', 'vocab'];

      const wrapper = document.createElement('div');
      wrapper.className = 'grid gap-4';

      const status = document.createElement('div');
      status.className = 'text-sm text-slate-600';
      status.textContent = 'Progreso: 0/20';
      wrapper.appendChild(status);

      const qbox = document.createElement('div');
      qbox.className = 'p-4 bg-white border rounded-xl';
      wrapper.appendChild(qbox);

      const nextBtn = document.createElement('button');
      nextBtn.className = 'px-4 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50';
      nextBtn.textContent = 'Siguiente';
      nextBtn.disabled = true;
      wrapper.appendChild(nextBtn);

      const result = document.createElement('div');
      result.className = 'hidden p-4 rounded-xl bg-indigo-50 border';
      wrapper.appendChild(result);

      quizRoot.appendChild(wrapper);

      let current = null; let lastCorrect = null;

      function drawQuestion() {
        const t = types[state.count % types.length];
        const candidates = bank[t].filter(item => item.level === state.level);
        const item = candidates[Math.floor(Math.random() * candidates.length)] || bank[t][0];
        current = item;

        qbox.innerHTML = '';
        const h = document.createElement('h4');
        h.className = 'text-lg font-bold';
        h.textContent = item.q;
        qbox.appendChild(h);

        if (item.audio) {
          const audio = document.createElement('audio'); audio.controls = true;
          // Placeholder: podrías poner src a un archivo local
          audio.innerHTML = '<source src="" type="audio/mp3">';
          const cap = document.createElement('p'); cap.className = 'mt-2 text-sm text-slate-500';
          cap.textContent = 'Transcripción: ' + item.transcript;
          qbox.appendChild(audio); qbox.appendChild(cap);
        }

        const list = document.createElement('div');
        list.className = 'mt-3 grid gap-2';
        item.a.forEach((opt, i) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'w-full text-left px-3 py-2 rounded-xl border hover-raise';
          b.textContent = opt;
          b.addEventListener('click', () => {
            const correct = (i === item.correct);
            lastCorrect = correct;
            if (correct) { b.classList.add('border-green-600'); state.score++; }
            else { b.classList.add('border-rose-600'); }
            Array.from(list.children).forEach(el => el.disabled = true);
            nextBtn.disabled = false;
          });
          list.appendChild(b);
        });
        qbox.appendChild(list);
        status.textContent = `Progreso: ${state.count}/${state.max}`;
      }

      drawQuestion();

      nextBtn.addEventListener('click', () => {
        nextBtn.disabled = true;
        state.count++;
        if (lastCorrect != null) state.level = pickNext(lastCorrect, state.level);

        if (state.count >= state.max) {
          qbox.innerHTML = '';
          result.classList.remove('hidden');
          const pct = Math.round(100 * state.score / state.max);
          let reco = 'Nivel sugerido: A2';
          if (pct >= 85) reco = 'Nivel sugerido: C1';
          else if (pct >= 70) reco = 'Nivel sugerido: B2';
          else if (pct >= 55) reco = 'Nivel sugerido: B1';
          else if (pct >= 40) reco = 'Nivel sugerido: A2';
          else reco = 'Nivel sugerido: A1';

          result.innerHTML = `<p class="font-semibold">Puntaje: ${state.score}/${state.max} (${pct}%). ${reco}.</p>
                              <p class="text-sm mt-1 text-slate-600">La recomendación se enviará a tu correo junto con opciones de curso.</p>`;
          status.textContent = `Progreso: ${state.max}/${state.max}`;
        } else {
          drawQuestion();
        }
      });
    }

    startBtn.addEventListener('click', buildQuiz);

    /* ==========================
       Accesibilidad – preferencias con localStorage
    =========================== */
    const adaBtn = document.getElementById('adaBtn');
    const adaPanel = document.getElementById('adaPanel');
    const adaClose = document.getElementById('adaClose');
    const root = document.body;

    const elContrast = document.getElementById('adaContrast');
    const elPause = document.getElementById('adaPause');
    const elLinks = document.getElementById('adaLinks');
    const elSpacing = document.getElementById('adaSpacing');
    const elZoom = document.getElementById('adaZoom');
    const elColor = document.getElementById('adaColor');

    const adaSave = document.getElementById('adaSave');
    const adaReset = document.getElementById('adaReset');

    function loadPrefs() {
      try {
        const prefs = JSON.parse(localStorage.getItem('ada-prefs') || '{}');
        toggleClass('ada-contrast', !!prefs.contrast);
        toggleClass('ada-pause-anim', !!prefs.pause);
        toggleClass('ada-highlight-links', !!prefs.links);
        toggleClass('ada-spacing', !!prefs.spacing);
        setZoom(prefs.zoom || 100);
        setColorFilter(prefs.color || '');

        elContrast.checked = !!prefs.contrast;
        elPause.checked = !!prefs.pause;
        elLinks.checked = !!prefs.links;
        elSpacing.checked = !!prefs.spacing;
        elZoom.value = prefs.zoom || 100;
        elColor.value = prefs.color || '';
      } catch(e) {}
    }
    function savePrefs() {
      const prefs = {
        contrast: elContrast.checked,
        pause: elPause.checked,
        links: elLinks.checked,
        spacing: elSpacing.checked,
        zoom: parseInt(elZoom.value, 10),
        color: elColor.value
      };
      localStorage.setItem('ada-prefs', JSON.stringify(prefs));
      loadPrefs();
    }
    function resetPrefs() {
      localStorage.removeItem('ada-prefs');
      elContrast.checked = elPause.checked = elLinks.checked = elSpacing.checked = false;
      elZoom.value = 100; elColor.value = '';
      savePrefs();
    }
    function toggleClass(cls, on) {
      root.classList.toggle(cls, on);
    }
    function setZoom(val) {
      root.style.fontSize = (val || 100) + '%';
    }
    function setColorFilter(kind) {
      root.classList.remove('ada-protanopia','ada-deuteranopia','ada-tritanopia');
      if (kind) root.classList.add('ada-' + kind);
    }

    adaBtn.addEventListener('click', () => { adaPanel.classList.remove('hidden'); adaPanel.classList.add('flex'); });
    adaClose.addEventListener('click', () => { adaPanel.classList.add('hidden'); adaPanel.classList.remove('flex'); });
    adaSave.addEventListener('click', () => { savePrefs(); adaClose.click(); });
    adaReset.addEventListener('click', resetPrefs);
    elContrast.addEventListener('change', () => toggleClass('ada-contrast', elContrast.checked));
    elPause.addEventListener('change', () => toggleClass('ada-pause-anim', elPause.checked));
    elLinks.addEventListener('change', () => toggleClass('ada-highlight-links', elLinks.checked));
    elSpacing.addEventListener('change', () => toggleClass('ada-spacing', elSpacing.checked));
    elZoom.addEventListener('input', () => setZoom(parseInt(elZoom.value, 10)));
    elColor.addEventListener('change', () => setColorFilter(elColor.value));

    loadPrefs();
  </script>
</body>
</html>
